# abs2paper 系统架构

## 1. 整体架构

abs2paper 是一个基于 RAG (检索增强生成) 的论文知识处理系统，主要分为以下几个核心组件：

```
                  ┌───────────────┐
                  │   用户界面    │
                  └───────┬───────┘
                          │
            ┌─────────────┴─────────────┐
            │                           │
    ┌───────▼──────┐            ┌───────▼──────┐
    │  知识存储流程 │            │  问答系统流程 │
    └───────┬──────┘            └───────┬──────┘
            │                           │
┌───────────┼───────────────────────────┼───────────┐
│           │         核心系统          │           │
│  ┌────────▼────────┐          ┌───────▼─────────┐ │
│  │  文本提取模块   │          │   检索模块     │ │
│  └────────┬────────┘          └───────┬─────────┘ │
│           │                           │           │
│  ┌────────▼────────┐          ┌───────▼─────────┐ │
│  │  向量数据库模块 │◄─────────►│  生成模块     │ │
│  └─────────────────┘          └─────────────────┘ │
└───────────────────────────────────────────────────┘
```

## 2. 核心模块说明

### 2.1 核心模块 (core)

- **db_manager.py**: 负责与Milvus向量数据库的交互，包括连接管理、集合创建、数据存储和检索
- **embedding.py**: 负责文本向量化，支持远程API和本地嵌入生成
- **llm_client.py**: 负责与语言模型API通信，支持多种LLM提供商

### 2.2 提取模块 (extraction)

- **text.py**: 从PDF文件中提取结构化文本，识别论文各部分
- **abstract.py**: 专门提取和处理论文摘要
- **component.py**: 提取论文的组件信息

### 2.3 处理模块 (processing)

- **labeling.py**: 论文标签处理，为文本内容添加主题标签
- **conclusion.py**: 处理和生成论文结论

### 2.4 RAG模块 (rag)

- **retriever.py**: 负责知识检索，根据查询在向量数据库中搜索相关内容
- **generator.py**: 负责回答生成，基于检索结果生成回答
- **prompt_builder.py**: 构建不同场景的提示词模板

## 3. 数据流

### 3.1 知识存储流程

```
PDF文件 ──► 文本提取 ──► 文本分块 ──► 生成嵌入 ──► 存储到向量数据库
```

1. 用户提供PDF文件和元数据（论文ID、主题等）
2. 系统提取PDF文本并识别结构（摘要、引言、方法等）
3. 对长文本进行分块处理，保持语义完整性
4. 为每个文本块生成向量嵌入
5. 将文本块、元数据和嵌入向量存储到Milvus集合中

### 3.2 问答流程

```
用户问题 ──► 生成查询向量 ──► 向量检索 ──► 构建提示词 ──► LLM生成回答
```

1. 用户提供问题和可选的主题过滤条件
2. 系统为问题生成向量嵌入
3. 在向量数据库中检索相关内容
4. 对检索结果进行排序和去重
5. 基于检索结果构建提示词
6. 调用LLM API生成最终回答

## 4. 数据结构

### 4.1 向量数据库结构

每个论文部分使用单独的集合，集合结构如下：

```
- id: 主键 (自动生成)
- paper_id: 论文唯一标识符
- content: 文本内容
- topics: 主题标签数组
- source: 来源 (文件名)
- section: 论文部分
- embedding: 向量嵌入
```

### 4.2 配置结构

系统配置采用层次化结构，包含以下主要部分：

```json
{
  "database": {
    "uri": "localhost:19530",
    "collection_prefix": "paper_",
    "search_limit": 10,
    "display_limit": 5
  },
  "embedding": {
    "model": "siliconflow",
    "dimension": 1024,
    "chunk_size": 500,
    "chunk_overlap": 50
  },
  "llm": {
    "provider": "siliconflow",
    "model": "mixtral-8x7b",
    "temperature": 0.7,
    "max_tokens": 1000,
    "timeout": 60
  }
}
```

## 5. 扩展性设计

系统设计考虑了以下扩展性：

1. **模块化结构**: 各组件之间低耦合，可独立升级和替换
2. **多LLM支持**: 支持不同的语言模型提供商，可轻松切换
3. **配置驱动**: 大多数行为通过配置文件控制，无需修改代码
4. **智能体框架预留**: 为未来集成智能体框架预留了接口

## 6. 未来发展路线

1. **智能体集成**: 添加智能体框架，使系统能够自主执行复杂任务
2. **多模态支持**: 增加对图表和公式的理解能力
3. **多语言支持**: 扩展多语言论文处理能力
4. **交互式探索**: 增加交互式论文探索功能 